<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide &mdash; Wi4MPI  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="_static/logo-square-blue.svg"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Welcome to Wi4MPI’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html">
            <img src="_static/logo-full-white.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#cmake-specific-variables">CMAKE specific variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#usage">Usage</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#quick-start">Quick start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tgcc-integration">TGCC integration</a></li>
<li class="toctree-l3"><a class="reference internal" href="#environment-settings">Environment settings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preload-settings">Preload settings</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interface-settings">Interface settings</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#wi4mpi-features">WI4MPI features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#default-conversion-mode">Default Conversion Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#static-mode">Static Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#extended-debug-mode">Extended Debug Mode</a></li>
<li class="toctree-l4"><a class="reference internal" href="#timeout-helper-thread">Timeout Helper Thread</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#developers-words">Developers words</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer_guide.html">Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="generator_guide.html">Generator Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Wi4MPI</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this heading">¶</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">¶</a></h2>
<p>MPI is a standard in HPC community which allows a simple use of
clusters. Nowoaday, there are several implementation (OpenMPI, BullxMPI,
MPT, IntelMPI, MPC, …) each of which involves a specific ABI
(Application Binary Interface) for an application compiled with a
specific MPI implementation. With wi4mpi, an application compiled with
an alpha MPI implementation can be run under a beta MPI implementation
without any compilation protocol and any concern about the ABI (Preload
version). WI4MPI can also be seen as a dedicated MPI implementation;
This time, the application is compiled against the wi4mpi library
(libmpi.so) whith the dedicated wrapper (mpicc,mpif90…) meant for that
purpose, and can be run under any other MPI implementation (Interface
Version).</p>
</section>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this heading">¶</a></h2>
<p>The installation procedureis simply consists of a cmake make install
sequence.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mkdir BUILD ; cd BUILD</span>
<span class="go">cmake -DCMAKE_INSTALL_PREFIX=/path/to/install/dir ..</span>
<span class="go">make</span>
<span class="go">make install</span>
</pre></div>
</div>
<section id="cmake-specific-variables">
<h3>CMAKE specific variables<a class="headerlink" href="#cmake-specific-variables" title="Permalink to this heading">¶</a></h3>
<ul>
<li><p>WI4MPI_COMPILER:string</p>
<p>Indicate which compilateur is used to compiled WI4MPI. Possible
options: INTEL(default), GNU, PGI, LLVM, ARMCLANG, FUJITSU</p>
</li>
<li><p>OPENMPI_ROOT</p>
<p>Open MPI root dir, put in wi4mpi.cfg, could be added
manually, optionnal value. This variable is required for Testing, one
must add -DOPENMPI_ROOT=/path/to/openmpi option.</p>
</li>
<li><p>INTELMPI_ROOT</p>
<p>Intel MPI root dir, put in wi4mpi.cfg, could be added
manually, optionnal value.</p>
</li>
<li><p>MPC_ROOT</p>
<p>MPC root dir, put in wi4mpi.cfg, could be added manually,
optionnal value.</p>
</li>
<li><p>MPICH_ROOT</p>
<p>MPICH root dir, put in wi4mpi.cfg, could be added
manually, optionnal value.</p>
</li>
<li><p>WI4MPI_RELEASE</p>
<p>Indicate the Wi4MPI state set for the installation:</p>
<blockquote>
<div><ul class="simple">
<li><p>DEBUG: -DDEBUG is provided to activate some debug information. Useful for WI4MPI and applications developer.</p></li>
<li><p>NORMAL: -g is provided</p></li>
<li><p>RELEASE: -g is not provided</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Both version (interface and preload) of wi4mpi are compiled and
installed into the CMAKE_INSTALL_PREFIX directory provided during the
cmake initialisation.</p>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this heading">¶</a></h2>
<p>As said in the introduction WI4MPI can be use with two different modes:</p>
<ul>
<li><p>INTERFACE</p>
<blockquote>
<div><p>The application is compiled using the mpi wrapper available
within WI4MPI</p>
<blockquote>
<div><ul class="simple">
<li><p>Interface -&gt; OpenMPI</p></li>
<li><p>Interface -&gt; IntelMPI</p></li>
<li><p>Interface -&gt; MPICH/MVAPICH</p></li>
<li><p>Interface -&gt; MPC</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
<li><p>PRELOAD</p>
<blockquote>
<div><p>The application is compiled using the mpi
wrapper available within common MPI Implementation Several conversions
can be performed by wi4mpi.</p>
<blockquote>
<div><ul class="simple">
<li><p>Interface -&gt; OpenMPI</p></li>
<li><p>Interface -&gt; IntelMPI</p></li>
<li><p>Interface -&gt; MPICH/MVAPICH</p></li>
<li><p>Interface -&gt; MPC</p></li>
<li><p>OpenMPI -&gt; OpenMPI</p></li>
<li><p>OpenMPI -&gt; IntelMPI</p></li>
<li><p>OpenMPI -&gt; MPICH/MVAPICH</p></li>
<li><p>OpenMPI -&gt; MPC</p></li>
<li><p>IntelMPI -&gt; OpenMPI</p></li>
<li><p>IntelMPI -&gt; IntelMPI</p></li>
<li><p>IntelMPI -&gt; MPICH/MVAPICH</p></li>
<li><p>IntelMPI -&gt; MPC</p></li>
<li><p>MPICH/MVAPICH -&gt; OpenMPI</p></li>
<li><p>MPICH/MVAPICH -&gt; IntelMPI</p></li>
<li><p>MPICH/MVAPICH -&gt; MPICH/MVAPICH</p></li>
<li><p>MPICH/MVAPICH -&gt; MPC</p></li>
</ul>
</div></blockquote>
</div></blockquote>
</li>
</ul>
<section id="quick-start">
<h3>Quick start<a class="headerlink" href="#quick-start" title="Permalink to this heading">¶</a></h3>
<p>WI4MPI dedicated launcher available in
/path-install/wi4mpi-%version/bin/wi4mpi allow an easy use of the
library. To work, users only have to set the path to the different MPI
implementation installation in
/path-install/wi4mpi-%version/etc/wi4mpi.cfg configuration file.</p>
<p>But, an mpirun command is also provided for more use.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">Usage: mpirun [MPIRUN_TARGET_OPTIONS] -- [PROGRAM] [PROGRAM_OPTIONS]</span>
<span class="go">Advanced options:</span>
<span class="go">    -F | -from | --from {FROM}      The MPI implentation from which PROGRAM was compiled with</span>
<span class="go">    -T | -to | --to {TARGET}        The MPI implentation to which PROGRAM will be run</span>

<span class="go">The -F FROM option is optionnal. If not provided, the interface mode is choosen.</span>
</pre></div>
</div>
<p>Example</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">mpirun -np 4 -F openmpi -T intelmpi mpi_hello.exe</span>
</pre></div>
</div>
<p>In this exemple wi4mpi understand that mpi_hello.exe is a binary file compiled with OpenMPI, which is run under IntelMPI.</p>
</section>
<section id="tgcc-integration">
<h3>TGCC integration<a class="headerlink" href="#tgcc-integration" title="Permalink to this heading">¶</a></h3>
<p>WI4MPI is available on the TGCC via its module environment. All the
environment settings detailed in the next section is hide by a system of
flavor and features specific to the center. The flavor indicates the
kind of the installation choosen by the users, on the other hand, the
features are used to set one of the choosen conversion we highlight in
the previous section.</p>
<p>(Flavors et features are modulefiles) Concerning the flavors:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">flavor</span><span class="o">/</span><span class="n">wi4mpi</span><span class="o">/</span><span class="p">{</span><span class="n">installation_type</span><span class="p">}</span> <span class="p">:</span> <span class="p">{</span><span class="n">installation_type</span><span class="p">}</span> <span class="n">can</span> <span class="n">be</span> <span class="n">debug</span> <span class="ow">or</span> <span class="n">standard</span>
</pre></div>
</div>
<p>Concerning the features:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">feature</span><span class="o">/</span><span class="n">wi4mpi</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="p">{</span><span class="n">MPI</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">version</span><span class="p">}</span> <span class="p">:</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">desired</span> <span class="n">MPI</span> <span class="n">version</span> <span class="k">for</span> <span class="n">the</span> <span class="n">runtime</span> <span class="p">({</span><span class="n">MPI</span><span class="p">}</span> <span class="n">can</span> <span class="n">take</span> <span class="n">two</span> <span class="n">value</span> <span class="n">OpenMPI</span> <span class="ow">or</span> <span class="n">IntelMPI</span><span class="p">)</span><span class="o">.</span>
<span class="o">-</span> <span class="n">feature</span><span class="o">/</span><span class="n">wi4mpi</span><span class="o">/</span><span class="n">from</span><span class="o">/</span><span class="p">{</span><span class="n">MPI</span><span class="p">}</span><span class="o">/</span><span class="p">{</span><span class="n">version</span><span class="p">}</span> <span class="p">:</span> <span class="n">indicates</span> <span class="n">the</span> <span class="n">MPI</span> <span class="n">version</span> <span class="n">used</span> <span class="n">to</span> <span class="n">compiled</span> <span class="n">the</span> <span class="n">binary</span> <span class="n">ELF</span> <span class="n">file</span> <span class="p">({</span><span class="n">MPI</span><span class="p">}</span> <span class="n">can</span> <span class="n">take</span> <span class="n">two</span> <span class="n">value</span> <span class="n">OpenMPI</span> <span class="ow">or</span> <span class="n">IntelMPI</span><span class="p">)</span><span class="o">.</span> <span class="n">This</span> <span class="n">features</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">prerequisites</span><span class="p">,</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">loaded</span> <span class="p">(</span><span class="n">which</span> <span class="ow">is</span> <span class="n">the</span> <span class="n">default</span> <span class="n">behaviour</span><span class="p">),</span> <span class="n">the</span> <span class="n">user</span> <span class="ow">is</span> <span class="n">using</span> <span class="n">WI4MPI</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">interface</span><span class="o">.</span>
</pre></div>
</div>
<p>Default behavior example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module load mpi/wi4mpi/%version
load module flavor/wi4mpi/standard (wi4mpi flavor)                                                  #Default installation is standard
load module feature/wi4mpi/to/openmpi/1.8.8 (WI4MPI feature to openmpi 1.8.8)                       #Default conversion is Interface -&gt; OpenMPI/1.8.8 (since no module feature/wi4mpi/from is loaded, the wi4mpi mode is interface)
load module feature/wi4mpi/mpi_compiler/intel (Wi4MPI compiler feature)                             #Default compilator use by mpi wrapper (mpicc,mpicxx,mpif90,...) within WI4MPI are Intel compilers
load module wi4mpi/3.3.0 (Wi4MPI with openmpi/1.8.8)

In this example, WI4MPI assume that the application is compiled with its own library libmpi.so

To simply change the conversion &quot;module switch feature/wi4mpi/to/intelmpi/2017&quot;
</pre></div>
</div>
<p>To activate the preload mode example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module load mpi/wi4mpi/%version
$ module load feature/wi4mpi/from/intelmpi/2017
load module feature/wi4mpi/from/intelmpi/2017 (WI4MPI feature from intelmpi 2017)
</pre></div>
</div>
</section>
<section id="environment-settings">
<h3>Environment settings<a class="headerlink" href="#environment-settings" title="Permalink to this heading">¶</a></h3>
<p>All variable used by WI4MPI to configure the library according to the
different modes and conversions.</p>
<ul class="simple">
<li><p>WI4MPI_ROOT : reference to root wi4mpi installation</p></li>
<li><p>WI4MPI_CC : reference C compiler used by wi4mpi</p></li>
<li><p>WI4MPI_FC : reference Fortran compiler used by wi4mpi</p></li>
<li><p>WI4MPI_CXX : reference C++ compiler used by wi4mpi</p></li>
<li><p>WI4MPI_RUN_MPI_C_LIB : reference the path to the underlying run MPI implementation path C library</p></li>
<li><p>WI4MPI_RUN_MPI_F_LIB : reference the path to the underlying run MPI implementation path Fortran library</p></li>
<li><p>WI4MPI_RUN_MPIIO_C_LIB : reference the path to the underlying run MPI-IO implementation path C library</p></li>
<li><p>WI4MPI_RUN_MPIIO_F_LIB : reference the path to the underlying run MPI-IO implementation path Fortran library</p></li>
<li><p>WI4MPI_WRAPPER_LIB : reference the path to the wrapper library call by the interface</p></li>
<li><p>WI4MPI_APP_INCLUDES : reference the path to the internal include used by the jit trick to handle user function</p></li>
<li><p>WI4MPI_COMPILE_OPT : reference the option passed during jit compilation</p></li>
<li><p>WI4MPI_INTERNAL_INCLUDE : reference the path to the internal include necessary to jit</p></li>
<li><p>WI4MPI_FROM : reference FROM which MPI implementation the application has been compiled</p></li>
<li><p>WI4MPI_TO : reference the desired Runtime MPI implementation</p></li>
<li><p>LD_PRELOAD : see man</p></li>
<li><p>LD_LIBRARY_PATH : see man</p></li>
</ul>
<section id="preload-settings">
<h4>Preload settings<a class="headerlink" href="#preload-settings" title="Permalink to this heading">¶</a></h4>
<p>{FROM} and {TO} can take as value OMPI or INTEL depending on the choosen
conversion.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPI_C_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPI-runtime-implementation/libmpi.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPI_F_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPI-runtime-implementation/libmpi_mpifh.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPIIO_C_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPIIO-runtime-implementation/libmpi.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPIIO_F_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPIIO-runtime-implementation/libmpi_mpifh.so&quot;</span>
<span class="nb">export</span> <span class="nv">LD_PRELOAD</span><span class="o">=</span><span class="s2">&quot;path_to_wi4mpi_install/libexec/libwi4mpi_{FROM}_{TO}.so </span><span class="nv">$WI4MPI_RUN_MPI_F_LIB</span><span class="s2"> </span><span class="nv">$WI4MPI_RUN_MPI_C_LIB</span><span class="s2">&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_APP_INCLUDES</span><span class="o">=</span><span class="s2">&quot;/path/to/wi4mpi/INTERNAL/preload/include/{FROM}_{TO}&quot;</span>
<span class="c1">#if OpenMPI --&gt; OpenMPI</span>
    <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;path_to_wi4mpi_install/libexec/fakelibCXX:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
    <span class="c1">#WI4MPI_COMPILE_OPT &quot;-DOMPI_OMPI&quot;</span>
<span class="c1">#else if OpenMPI --&gt; IntelMPI</span>
    <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;path_to_wi4mpi_install/libexec/fakelibCXX:path_to_wi4mpi_install/libexec/fakelibOMPI:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
    <span class="c1">#WI4MPI_COMPILE_OPT &quot;-DOMPI_INTEL&quot;</span>
<span class="c1">#else if IntelMPI --&gt; IntelMPI</span>
    <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;path_to_wi4mpi_install/libexec/fakelibCXX:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
    <span class="c1">#WI4MPI_COMPILE_OPT &quot;-DINTEL_INTEL&quot;</span>
<span class="c1">#else if IntelMPI --&gt; OpenMPI</span>
    <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;path_to_wi4mpi_install/libexec/fakelibCXX:path_to_wi4mpi_install/libexec/fakelibINTEL:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
    <span class="c1">#WI4MPI_COMPILE_OPT &quot;-DINTEL_OMPI&quot;</span>
</pre></div>
</div>
</section>
<section id="interface-settings">
<h4>Interface settings<a class="headerlink" href="#interface-settings" title="Permalink to this heading">¶</a></h4>
<p>{FROM} and {TO} can take as value OMPI or INTEL depending on the choosen
conversion</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">WI4MPI_INTERNAL_INCLUDES</span><span class="o">=</span><span class="s2">&quot;path_to_install/INTERNAL/include&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_ROOT</span><span class="o">=</span><span class="s2">&quot;/path_to_wi4mpi_install_root&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_CC</span><span class="o">=</span>icc
<span class="nb">export</span> <span class="nv">WI4MPI_FC</span><span class="o">=</span>ifort
<span class="nb">export</span> <span class="nv">WI4MPI_CXX</span><span class="o">=</span>icpc
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPI_C_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPI-runtime-implementation/libmpi.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPI_F_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPI-runtime-implementation/libmpi_mpifh.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPIIO_C_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPI-runtime-implementation/libmpi.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_RUN_MPIIO_F_LIB</span><span class="o">=</span><span class="s2">&quot;/path/to/MPI-runtime-implementation/libmpi_mpifh.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_WRAPPER_LIB</span><span class="o">=</span><span class="s2">&quot;path_to_wi4mpi_install/lib_IMPI/libwi4mpi_CCC_{TO}.so&quot;</span>
<span class="nb">export</span> <span class="nv">WI4MPI_APP_INCLUDES</span><span class="o">=</span><span class="s2">&quot;path_to_install/INTERNAL/interface/include/{FROM}_{TO}&quot;</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">&quot;path_to_install/lib:</span><span class="nv">$LD_LIBRARY_PATH</span><span class="s2">&quot;</span>
<span class="c1">#if Interface --&gt; IntelMPI</span>
    <span class="nb">export</span> <span class="nv">WI4MPI_COMPILE_OPT</span><span class="o">=</span><span class="s2">&quot;-D_OMPI&quot;</span>
<span class="c1">#else if Interface --&gt; OpenMPI</span>
    <span class="nb">export</span> <span class="nv">WI4MPI_COMPILE_OPT</span><span class="o">=</span><span class="s2">&quot;-D_INTEL&quot;</span>
</pre></div>
</div>
</section>
</section>
<section id="wi4mpi-features">
<h3>WI4MPI features<a class="headerlink" href="#wi4mpi-features" title="Permalink to this heading">¶</a></h3>
<section id="default-conversion-mode">
<h4>Default Conversion Mode<a class="headerlink" href="#default-conversion-mode" title="Permalink to this heading">¶</a></h4>
<p>During compilation time of the application, users are able to set a
default conversion using WI4MPI compiling wrapper by providing the
-wi4mpi_default_run_path option.</p>
<p>example:</p>
<blockquote>
<div><p>mpicc -wi4mpi_default_run_path OMPI hello.c -o hello</p>
</div></blockquote>
<p>Two values can be passed with -wi4mpi_default_run_path:</p>
<blockquote>
<div><ul class="simple">
<li><p>OMPI : set the default conversion to _INTEL</p></li>
<li><p>IMPI : set the default conversion to _OMPI</p></li>
</ul>
</div></blockquote>
<p>The runtime MPI library used is the ones referenced in the
etc/wi4mpi.cfg file, but be aware that they can be overided using the
WI4MPI_RUN_MPI_C_LIB, and WI4MPI_RUN_MPI_F_LIB environment
variables as follow.</p>
<blockquote>
<div><p>WI4MPI_RUN_MPI_C_LIB=”/path” WI4MPI_RUN_MPI_F_LIB=”/path” mpicc -wi4mpi_default_run_path OMPI hello.c -o hello</p>
</div></blockquote>
<p>When the environment is set, the default conversion is not taken in
account.</p>
</section>
<section id="static-mode">
<h4>Static Mode<a class="headerlink" href="#static-mode" title="Permalink to this heading">¶</a></h4>
<p>There is a static mode in wi4mpi : this mode need to use the interface header and link to libmpi.a. All conversion are embedded and two environement variable specify the conversion type : WI4MPI_STATIC_TARGET_TYPE_F for fortran conversion and WI4MPI_STATIC_TARGET_TYPE for C/C++ conversion; supported value are : OMPI and INTEL.</p>
<p>Use is the following</p>
<blockquote>
<div><p>set WI4MPI_RUN_MPI_C_LIB,WI4MPI_RUN_MPI_F_LIB to respective target library
set WI4MPI_STATIC_TARGET_TYPE,WI4MPI_STATIC_TARGET_TYPE_F to conversion typeaccording to target library.
run executable.</p>
</div></blockquote>
</section>
<section id="extended-debug-mode">
<h4>Extended Debug Mode<a class="headerlink" href="#extended-debug-mode" title="Permalink to this heading">¶</a></h4>
<p>As seen before, one is able to compile Wi4MPI with debug symbols thanks
to “-DWI4MPI_REALEASE=DEBUG”. Moreover, this setting enable an extended
debug mode. This feature allow to select any MPI function and print
input/ouput values after each call. One can select functions with
“WI4_debug=1” environment variable (WI4MPI_Init_debut,
WI4MPI_Allreduce_debug…).</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -n 1 ./hello
You are using Wi4MPI-3.3.0a with the mode interface From Interface To OpenMPI-2.0.4
Hello from 1/1

$ WI4MPI_Init_debug=1 mpirun -n 1 ./hello
You are using Wi4MPI-3.3.0a with the mode interface From Interface To OpenMPI-2.0.4
MPI_Init :
{
argc : 1,
argv : [
./hello.wmpi
]
,
error/return : 0
}
Hello from 1/1
</pre></div>
</div>
<p>Debug output print respects JSON format in order to be easily parsed.</p>
</section>
<section id="timeout-helper-thread">
<h4>Timeout Helper Thread<a class="headerlink" href="#timeout-helper-thread" title="Permalink to this heading">¶</a></h4>
<p>For any reason you may want to kill a process which has passed too many
time into a function. Wi4MPI allow you to add a timeout to any MPI
function with “WI4_timeout=” environment variables
(WI4MPI_Init_timeout, WI4MPI_Allreduce_timeout…).</p>
<p>Examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mpirun -n 1 ./hello
You are using Wi4MPI-3.3.0a with the mode interface From Interface To OpenMPI-2.0.4
Hello from 1/1

$ WI4MPI_Init_timeout=1 mpirun -n 1 ./hello
Wi4MPI error: processus 25572 on host r0login has reached a timeout!
Aborted
</pre></div>
</div>
</section>
</section>
</section>
<section id="developers-words">
<h2>Developers words<a class="headerlink" href="#developers-words" title="Permalink to this heading">¶</a></h2>
<p>First of all thanks a lot for using the wi4mpi software. Nevertheless be
aware that this software is still under development and that some bugs
may remain. If you encounter one of them, don’t hesitate to contact one
of the authors and so to participate to the software robustness. Second,
wi4mpi is compatible with the 3.1 MPI norm. Don’t hesitate to
participate :-)</p>
<p><a class="reference external" href="https://github.com/cea-hpc/wi4mpi">https://github.com/cea-hpc/wi4mpi</a></p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to Wi4MPI’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tutorial.html" class="btn btn-neutral float-right" title="Tutorial" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2016-2022, CEA - Commissariat de l&#39;Énerge Atomique.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>